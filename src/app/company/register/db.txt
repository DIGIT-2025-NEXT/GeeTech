CREATE EXTENSION IF NOT EXISTS citext;

CREATE TYPE application_status AS ENUM (
  'pending',    -- 申請中（未処理）
  'approved',
  'rejected'
);

CREATE TYPE project_status AS ENUM (
  'draft',      -- 下書き
  'active',     -- 募集中
  'closed',     -- 終了
  'cancelled'   -- キャンセル
);

-- 申請ワークフロー用テーブル（主に管理者が扱う）
CREATE TABLE company_applications (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  company_name text NOT NULL,
  president_name text,
  contact_email citext NOT NULL,
  contact_phone text,
  website text,
  logo_url text,
  industry_id uuid,            -- 業種のテーブルがある
  number_of_employees int,
  year_of_establishment date,
  address text,
  description text,
  business_detail text,
  is_without_recompense boolean DEFAULT false,
  application_status application_status DEFAULT 'pending',
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

CREATE INDEX ON company_applications (application_status);
CREATE INDEX ON company_applications (created_at);
CREATE INDEX ON company_applications (lower(company_name));

-- プロジェクトテーブル
CREATE TABLE project (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  company_id uuid NOT NULL,
  title text NOT NULL,
  description text,
  skills text[],
  status project_status DEFAULT 'draft',
  created_at timestamptz DEFAULT now()
);

CREATE INDEX ON project (company_id);
CREATE INDEX ON project (status);
CREATE INDEX ON project (created_at);